<!DOCTYPE html>
<html lang="it" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Analyzer</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="min-h-screen">
    <div class="container mx-auto p-4">
        <header class="navbar mb-8">
            <div class="flex-1">
                <div class="flex items-center gap-2">
                    <div class="text-primary text-2xl">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h1 class="text-xl font-bold">Password Analyzer</h1>
                </div>
            </div>
            <button class="btn btn-circle btn-ghost theme-toggle">
                <i class="fas fa-moon"></i>
            </button>
        </header>

        <div class="card bg-base-100 shadow-xl mb-4">
            <div class="card-body">
                <h2 class="card-title">Controlla la sicurezza della tua password</h2>
                <p>Inserisci la password da analizzare per valutarne la forza e identificare vulnerabilit√†</p>
                
                <div class="join w-full mt-4">
                    <input type="password" 
                           id="passwordInput" 
                           placeholder="Inserisci la password..." 
                           class="join-item input input-bordered w-full">
                    <button id="analyzeBtn" class="join-item btn btn-primary">
                        Analizza
                    </button>
                </div>

                <div class="w-full bg-base-200 rounded-full h-2 mt-4">
                    <div id="progressBar" class="bg-primary h-2 rounded-full w-0"></div>
                </div>
            </div>
        </div>

        <div id="results" class="hidden">
            <div class="card bg-base-100 shadow-xl mb-4">
                <div class="card-body">
                    <h3 class="card-title">Risultati dell'analisi</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div class="stats bg-base-200">
                            <div class="stat">
                                <div class="stat-title">Lunghezza</div>
                                <div id="length" class="stat-value text-2xl">0</div>
                            </div>
                        </div>
                        
                        <div class="stats bg-base-200">
                            <div class="stat">
                                <div class="stat-title">Entropia</div>
                                <div id="entropy" class="stat-value text-2xl">0 bit</div>
                            </div>
                        </div>
                        
                        <div class="stats bg-base-200">
                            <div class="stat">
                                <div class="stat-title">Caratteri usati</div>
                                <div id="charset" class="stat-value text-2xl">0</div>
                            </div>
                        </div>
                    </div>

                    <div id="leakCheck" class="mt-4"></div>
                    
                    <div class="divider"></div>
                    
                    <div id="strengthIndicator" class="alert mt-4">
                        <i class="fas fa-info-circle"></i>
                        <span>Analisi in corso...</span>
                    </div>

                    <div id="dictionaryCheck" class="mt-4"></div>

                    <div class="mt-6">
                        <h4 class="text-lg font-bold mb-2">Tempi di cracking stimati:</h4>
                        <div id="crackTimes" class="space-y-2"></div>
                    </div>

                    <div class="divider"></div>

                    <div id="suggestions" class="mt-4">
                        <h4 class="text-lg font-bold mb-2">Suggerimenti:</h4>
                        <ul class="list-disc pl-6"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Costanti e configurazioni
        const LOWERCASE = 'abcdefghijklmnopqrstuvwxyz';
        const UPPERCASE = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const DIGITS = '0123456789';
        const SPECIAL = '!@#$%^&*()_+-=[]{}|;:,.<>?';

        const commonWords = {
            english: ['password', 'admin', 'qwerty', 'letmein', 'baseball', 'dragon'],
            italian: ['password', 'admin', 'juventus', 'roma', 'milano', 'firenze', 'pizza']
        };

        // Elementi UI
        const themeToggle = document.querySelector('.theme-toggle');
        const passwordInput = document.getElementById('passwordInput');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const results = document.getElementById('results');
        const progressBar = document.getElementById('progressBar');

        // Animazioni
        const animateResults = () => {
            anime({
                targets: '#results .card',
                opacity: [0, 1],
                translateY: [30, 0],
                duration: 800,
                easing: 'easeOutExpo'
            });
        };

        const animateStats = () => {
            anime({
                targets: '.stats',
                scale: [0.9, 1],
                opacity: [0, 1],
                delay: anime.stagger(100),
                duration: 600,
                easing: 'spring(1, 80, 10, 0)'
            });
        };

        // Funzioni core
        async function checkPasswordLeak(password) {
            try {
                const proxyUrl = 'https://corsproxy.io/?' + 
                    encodeURIComponent(`https://leakcheck.net/api/public?key=public&check=${password}`);
                
                const response = await fetch(proxyUrl);
                const data = await response.json();
                return data;
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        function analyzePassword(password) {
            const usedTypes = {
                lowercase: /[a-z]/.test(password),
                uppercase: /[A-Z]/.test(password),
                digits: /[0-9]/.test(password),
                special: /[^a-zA-Z0-9]/.test(password)
            };

            let charSetSize = 0;
            Object.values(usedTypes).forEach(used => used && charSetSize++ * 26);

            const combinations = Math.pow(charSetSize * 26, password.length);
            const entropy = Math.log2(combinations);

            const crackTimes = {
                "PC Desktop": combinations / 1e6,
                "PC Gaming": combinations / 1e7,
                "Server Farm": combinations / 1e9
            };

            const commonWordsFound = Object.values(commonWords)
                .flat()
                .filter(word => password.toLowerCase().includes(word));

            return {
                length: password.length,
                entropy,
                charSetSize: charSetSize * 26,
                usedTypes,
                crackTimes,
                commonWords: commonWordsFound,
                hasRepeated: /(.)\1{2}/.test(password)
            };
        }

        // Update UI
        async function updateUI(analysis) {
            document.getElementById('length').textContent = analysis.length;
            document.getElementById('entropy').textContent = `${analysis.entropy.toFixed(2)} bit`;
            document.getElementById('charset').textContent = analysis.charSetSize;

            // Strength indicator
            const strengthIndicator = document.getElementById('strengthIndicator');
            strengthIndicator.className = 'alert mt-4';
            if (analysis.entropy < 60) {
                strengthIndicator.classList.add('alert-warning');
                strengthIndicator.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Password debole (entropia bassa)`;
            } else if (analysis.entropy < 100) {
                strengthIndicator.classList.add('alert-info');
                strengthIndicator.innerHTML = `<i class="fas fa-info-circle"></i> Password moderata`;
            } else {
                strengthIndicator.classList.add('alert-success');
                strengthIndicator.innerHTML = `<i class="fas fa-shield-alt"></i> Password forte!`;
            }

            // Crack times
            const crackTimesDiv = document.getElementById('crackTimes');
            crackTimesDiv.innerHTML = Object.entries(analysis.crackTimes)
                .map(([device, seconds]) => `
                    <div class="flex justify-between p-2 bg-base-200 rounded">
                        <span>${device}</span>
                        <span>${formatTime(seconds)}</span>
                    </div>
                `).join('');

            // Suggestions
            const suggestions = document.getElementById('suggestions ul');
            suggestions.innerHTML = [
                analysis.length < 12 && 'Aumenta la lunghezza a almeno 12 caratteri',
                !analysis.usedTypes.lowercase && 'Aggiungi lettere minuscole',
                !analysis.usedTypes.uppercase && 'Aggiungi lettere maiuscole',
                !analysis.usedTypes.digits && 'Aggiungi numeri',
                !analysis.usedTypes.special && 'Aggiungi caratteri speciali',
                analysis.commonWords.length > 0 && 'Evita parole comuni',
                analysis.hasRepeated && 'Evita caratteri ripetuti'
            ].filter(Boolean).map(s => `<li>${s}</li>`).join('');

            animateStats();
        }

        function formatTime(seconds) {
            const intervals = [
                [31536000, 'anni'],
                [86400, 'giorni'], 
                [3600, 'ore'],
                [60, 'minuti']
            ];

            for (let [divisor, label] of intervals) {
                if (seconds >= divisor) {
                    return `${(seconds / divisor).toFixed(1)} ${label}`;
                }
            }
            return `${seconds.toFixed(1)} secondi`;
        }

        // Event handlers
        themeToggle.addEventListener('click', () => {
            const html = document.documentElement;
            const isDark = html.getAttribute('data-theme') === 'dark';
            html.setAttribute('data-theme', isDark ? 'light' : 'dark');
            themeToggle.querySelector('i').className = isDark ? 'fas fa-moon' : 'fas fa-sun';
        });

        analyzeBtn.addEventListener('click', async () => {
            const password = passwordInput.value;
            if (!password) return;

            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<span class="loading loading-spinner"></span> Analisi...';

            anime({
                targets: progressBar,
                width: '100%',
                duration: 1500,
                easing: 'easeOutExpo',
                complete: () => progressBar.style.width = '0%'
            });

            try {
                const analysis = analyzePassword(password);
                const leakCheck = await checkPasswordLeak(password);
                
                if (leakCheck?.found > 0) {
                    document.getElementById('leakCheck').innerHTML = `
                        <div class="alert alert-error">
                            <i class="fas fa-skull-crossbones"></i>
                            Password trovata in ${leakCheck.found} data breach!
                        </div>
                    `;
                }

                await new Promise(resolve => setTimeout(resolve, 1000));
                results.classList.remove('hidden');
                animateResults();
                updateUI(analysis);
            } catch (error) {
                console.error(error);
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = 'Analizza';
            }
        });

        passwordInput.addEventListener('keypress', e => {
            if (e.key === 'Enter') analyzeBtn.click();
        });
    </script>
</body>
</html>
